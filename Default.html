<!--
Project: Trafilm.Gallery (http://github.com/zoomicon/Trafilm.Gallery)
Filename: default.html
Version: 20180423
-->

<html> <!-- do not use DOCTYPE statement -->

<head>
  <title>Trafilm Gallery | The Translation of Multilingual Films in Spain</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=700, user-scalable=yes, initial-scale=0.6" />

  <link rel="shortcut icon" type="image/ico" href='favicon.ico' />

  <style type="text/css">
  body
  {
    margin:0;
    padding:0;
    overflow-y:auto;
  }
  
  iframe 
  {
    width:100%;
    height:100%;
    border:0;
    margin:0;
    padding:0;
  }
  </style>
  
  <script type="text/javascript">
  
  var pivotFilms, pivotConversations, pivotL3STinstances, pivotL3TTinstances; 
  
  addEventListener("load", function () {
    pivotFilms = document.getElementById("frameFilms").contentDocument.getElementsByClassName("pivot_ajax_viewer")[0].pivotViewer;
    pivotConversations = document.getElementById("frameConversations").contentDocument.getElementsByClassName("pivot_ajax_viewer")[0].pivotViewer;
    pivotL3STinstances = document.getElementById("frameL3STinstances").contentDocument.getElementsByClassName("pivot_ajax_viewer")[0].pivotViewer;
    pivotL3TTinstances = document.getElementById("frameL3TTinstances").contentDocument.getElementsByClassName("pivot_ajax_viewer")[0].pivotViewer;
    
    var bind = function(parentPivot, parentFacet, childPivot, childParentFacet) {
      var bindOneWay = function(parentPivot, parentFacet, childPivot, childParentFacet) {
        parentPivot.addListener("finishedRearrange", function () {
          var activeItems = parentPivot.getActiveItems(); //runFiltersWithout(null); //TODO: without getActiveItems can use official seajax distro
          
          var activeValues = activeItems.map(function (item) { return (!parentFacet)?item.id:item.facets[parentFacet][0] });
          if (activeValues.length===1) activeValues.push(activeValues[0]); //workarround for filterrequest's special handling of length===1
          
          //activeValues.forEach(function (value) { console.log(value); });

          childPivot.trigger("filterrequest", {
                        facet: childParentFacet,
                        values: activeValues,
                        type: "String"
          });
        });
      };
        
      bindOneWay(parentPivot, parentFacet, childPivot, childParentFacet); //propagate from parent to child
      //bindOneWay(childPivot, childParentFacet, parentPivot, parentFacet); //propagate from child to parent //TODO: fix, seems to loop (could check at "filterRequest" if items differes from activeItems to propagate further via "filterrrequest"
    };
     
    //propagate pivot active items change
    bind(pivotFilms, "Reference Id", pivotConversations, "Film Reference Id");
    bind(pivotConversations, "Reference Id", pivotL3STinstances, "Conversation Reference Id");
    bind(pivotL3STinstances, "Reference Id", pivotL3TTinstances, "L3ST-instance Reference Id");   
  });
  </script>

</head>

<body>
  <iframe id="frameFilms" src="http://gallery.trafilm.net/film">
    <a href="http://gallery.trafilm.net/film">Trafilm Gallery | Films</a>
  </iframe>

  <iframe id="frameConversations" src="http://gallery.trafilm.net/conversation">
    <a href="http://gallery.trafilm.net/conversation">Trafilm Gallery | Conversations</a>
  </iframe>

  <iframe id="frameL3STinstances" src="http://gallery.trafilm.net/L3STinstance">
    <a href="http://gallery.trafilm.net/L3STinstance">Trafilm Gallery | L3ST-instances</a>
  </iframe>

  <iframe id="frameL3TTinstances" src="http://gallery.trafilm.net/L3TTinstance">
    <a href="http://gallery.trafilm.net/L3TTinstance">Trafilm Gallery | L3TT-instances</a>
  </iframe>
</body>

</html>